<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TileGame 3D</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        <div id="screen-flash"></div>
    </div>

    <!-- Main Menu -->
    <div id="main-menu">
        <h1>TileGame 3D</h1>
        <div class="class-selection">
            <h3>Choose Class</h3>
            <div class="class-buttons">
                <button class="class-btn selected" data-class="warrior">Warrior</button>
                <button class="class-btn" data-class="mage">Mage</button>
                <button class="class-btn" data-class="hunter">Hunter</button>
            </div>
        </div>
        <div class="menu-options">
            <button class="menu-btn" data-mode="adventure">Adventure</button>
            <button class="menu-btn" data-mode="horde">Skeleton Horde</button>
        </div>
    </div>

    <!-- Quest Tracker UI -->
    <div id="quest-tracker">
        <div id="quest-tracker-header">Quests</div>
        <div id="quest-tracker-list"></div>
    </div>

    <!-- NPC Dialog -->
    <div id="npc-dialog">
        <div id="npc-dialog-content">
            <div id="npc-dialog-header">
                <span id="npc-name">NPC Name</span>
                <button id="npc-dialog-close">X</button>
            </div>
            <div id="npc-dialog-text"></div>
            <div id="npc-dialog-options"></div>
        </div>
    </div>

    <!-- NPC Interaction Prompt -->
    <div id="npc-prompt" class="interaction-prompt">
        <span class="prompt-key">F</span>
        <span class="prompt-text">Talk</span>
    </div>

    <div id="ui">
        <div id="health-bar">
            <div id="health-fill"></div>
            <span id="health-text">100 / 100</span>
        </div>
        <div id="controls-hint">
            <span>WASD: Move</span>
            <span>LMB: Click to Move/Attack</span>
            <span>RMB: Target/Turn</span>
            <span>Tab: Cycle Target</span>
            <span>Space: Jump</span>
        </div>
        <div id="ability-bar">
            <div class="ability" id="ability-q">
                <span class="key">Q</span>
                <span class="name">Cleave</span>
                <div class="cooldown-overlay"></div>
            </div>
            <div class="ability" id="ability-f">
                <span class="key">F</span>
                <span class="name">Whirlwind</span>
                <div class="cooldown-overlay"></div>
            </div>
            <div class="ability" id="ability-e">
                <span class="key">E</span>
                <span class="name">Parry</span>
                <div class="cooldown-overlay"></div>
            </div>
            <div class="ability" id="ability-r">
                <span class="key">R</span>
                <span class="name">Heroic Leap</span>
                <div class="cooldown-overlay"></div>
            </div>
            <div class="ability" id="ability-c">
                <span class="key">C</span>
                <span class="name">Sunder</span>
                <div class="cooldown-overlay"></div>
            </div>
        </div>
        <!-- Hotbar for quick-use consumables -->
        <div id="hotbar">
            <div class="hotbar-slot" data-slot="0">
                <span class="hotbar-key">1</span>
                <div class="hotbar-item"></div>
                <div class="hotbar-quantity"></div>
                <div class="hotbar-cooldown"></div>
            </div>
            <div class="hotbar-slot" data-slot="1">
                <span class="hotbar-key">2</span>
                <div class="hotbar-item"></div>
                <div class="hotbar-quantity"></div>
                <div class="hotbar-cooldown"></div>
            </div>
            <div class="hotbar-slot" data-slot="2">
                <span class="hotbar-key">3</span>
                <div class="hotbar-item"></div>
                <div class="hotbar-quantity"></div>
                <div class="hotbar-cooldown"></div>
            </div>
            <div class="hotbar-slot" data-slot="3">
                <span class="hotbar-key">4</span>
                <div class="hotbar-item"></div>
                <div class="hotbar-quantity"></div>
                <div class="hotbar-cooldown"></div>
            </div>
            <div class="hotbar-slot" data-slot="4">
                <span class="hotbar-key">5</span>
                <div class="hotbar-item"></div>
                <div class="hotbar-quantity"></div>
                <div class="hotbar-cooldown"></div>
            </div>
            <div id="gold-display">
                <span id="gold-icon">$</span>
                <span id="gold-amount">0</span>
            </div>
        </div>
    </div>

    <!-- Inventory Panel -->
    <div id="inventory-panel">
        <div id="inventory-header">
            <span>Inventory</span>
            <button id="inventory-close">X</button>
        </div>
        <div id="inventory-content">
            <div id="equipment-section">
                <div class="equip-slot" data-slot="helmet">
                    <span class="equip-label">Head</span>
                </div>
                <div class="equip-slot" data-slot="weapon">
                    <span class="equip-label">Weapon</span>
                </div>
                <div class="equip-slot" data-slot="chest">
                    <span class="equip-label">Chest</span>
                </div>
                <div class="equip-slot" data-slot="gloves">
                    <span class="equip-label">Hands</span>
                </div>
                <div class="equip-slot" data-slot="boots">
                    <span class="equip-label">Feet</span>
                </div>
                <div class="equip-slot" data-slot="ring">
                    <span class="equip-label">Ring</span>
                </div>
                <div class="equip-slot" data-slot="amulet">
                    <span class="equip-label">Amulet</span>
                </div>
            </div>
            <div id="inventory-grid"></div>
        </div>
        <div id="equipment-stats">
            <span>DMG: <span id="stat-damage">0</span></span>
            <span>DEF: <span id="stat-defense">0</span></span>
        </div>
    </div>

    <!-- Item Tooltip -->
    <div id="item-tooltip">
        <div id="tooltip-name"></div>
        <div id="tooltip-type"></div>
        <div id="tooltip-stats"></div>
        <div id="tooltip-desc"></div>
    </div>

    <!-- Crosshair removed - using visible cursor now -->

    <div id="target-frame">
        <div id="target-name">Skeleton</div>
        <div id="target-health-bar">
            <div id="target-health-fill"></div>
        </div>
    </div>

    <button id="return-menu-btn">Menu</button>

    <div id="minimap">
        <canvas id="minimap-canvas" width="180" height="180"></canvas>
        <span id="minimap-label">Map</span>
    </div>

    <!-- Save Indicator -->
    <div id="save-indicator">
        <span id="save-icon">üíæ</span>
        <span id="save-text">Saved</span>
    </div>

    <!-- Fishing Prompt -->
    <div id="fishing-prompt" class="interaction-prompt">
        <span class="prompt-key">F</span>
        <span class="prompt-text">Fish</span>
    </div>

    <!-- Fishing Status -->
    <div id="fishing-status">
        <span id="fishing-text">Fishing...</span>
    </div>

    <!-- Fishing Minigame Popup -->
    <div id="fishing-popup">
        <div id="fishing-popup-content">
            <div id="fishing-popup-header">
                <span id="fishing-popup-title">Fishing!</span>
                <span id="fishing-popup-hint">Press the keys!</span>
            </div>
            <div id="fishing-game-area">
                <!-- Timer Display -->
                <div id="qte-timer-display">
                    <span id="qte-time-remaining">30</span>
                    <span id="qte-time-label">seconds</span>
                </div>
                <!-- QTE Key Display with Queue -->
                <div id="qte-container">
                    <div id="qte-key-display">
                        <span id="qte-current-key">W</span>
                        <div id="qte-timer-ring">
                            <svg viewBox="0 0 100 100">
                                <circle id="qte-timer-bg" cx="50" cy="50" r="45"/>
                                <circle id="qte-timer-fill" cx="50" cy="50" r="45"/>
                            </svg>
                        </div>
                    </div>
                    <div id="qte-key-queue">
                        <span class="queue-key">A</span>
                        <span class="queue-key">S</span>
                        <span class="queue-key">D</span>
                        <span class="queue-key">W</span>
                        <span class="queue-key">A</span>
                    </div>
                    <div id="qte-feedback"></div>
                </div>
                <!-- Score Display -->
                <div id="qte-score-area">
                    <div id="qte-fish-caught">
                        <span id="qte-fish-icon">üêü</span>
                        <span id="qte-fish-value">0</span>
                    </div>
                    <div id="qte-combo">
                        <span id="qte-combo-label">Combo</span>
                        <span id="qte-combo-value">0</span>
                    </div>
                    <div id="qte-score">
                        <span id="qte-score-label">Score</span>
                        <span id="qte-score-value">0</span>
                    </div>
                </div>
            </div>
            <div id="fishing-popup-footer">
                <span id="fishing-status-text">Waiting for bite...</span>
            </div>
        </div>
    </div>

    <!-- Fishing Message -->
    <div id="fishing-message"></div>

    <!-- Cooking Prompt -->
    <div id="cooking-prompt" class="interaction-prompt">
        <span class="prompt-key">F</span>
        <span class="prompt-text">Cook</span>
    </div>

    <!-- Cooking Selection Popup -->
    <div id="cooking-selection">
        <div id="cooking-selection-content">
            <div id="cooking-selection-header">
                <span id="cooking-selection-title">Select Fish to Cook</span>
                <button id="cooking-selection-close">X</button>
            </div>
            <div id="cooking-selection-grid"></div>
            <div id="cooking-selection-footer">
                <span>Click a fish to start cooking</span>
            </div>
        </div>
    </div>

    <!-- Cooking Popup -->
    <div id="cooking-popup">
        <div id="cooking-popup-content">
            <div id="cooking-popup-header">
                <span id="cooking-popup-title">Cooking!</span>
            </div>
            <div id="cooking-game-area">
                <div id="cooking-score-area">
                    <div id="cooking-flips">
                        <span id="cooking-flips-label">Cooked</span>
                        <span id="cooking-flips-value">0 / 0</span>
                    </div>
                    <div id="cooking-quality">
                        <span id="cooking-quality-label">Progress</span>
                        <div id="cooking-quality-bar">
                            <div id="cooking-quality-fill"></div>
                        </div>
                    </div>
                    <div id="cooking-rating">
                        <span id="cooking-rating-value">Cooking...</span>
                    </div>
                </div>
            </div>
            <div id="cooking-popup-footer">
                <span id="cooking-status-text">Cooking fish...</span>
            </div>
        </div>
    </div>

    <!-- Cooking Message -->
    <div id="cooking-message"></div>

    <!-- Mining Prompt -->
    <div id="mining-prompt" class="interaction-prompt">
        <span class="prompt-key">F</span>
        <span class="prompt-text">Mine</span>
    </div>

    <!-- Mining Selection Popup -->
    <div id="mining-selection">
        <div id="mining-selection-content">
            <div id="mining-selection-header">
                <span id="mining-selection-title">Select Ore to Mine</span>
                <button id="mining-selection-close">X</button>
            </div>
            <div id="mining-selection-grid"></div>
            <div id="mining-selection-footer">
                <span>Click an ore to start mining</span>
            </div>
        </div>
    </div>

    <!-- Mining Popup -->
    <div id="mining-popup">
        <div id="mining-popup-content">
            <div id="mining-popup-header">
                <span id="mining-popup-title">Mining!</span>
                <span id="mining-popup-hint">Press SPACE to swing!</span>
            </div>
            <div id="mining-game-area">
                <!-- Timer Display -->
                <div id="mining-timer-display">
                    <span id="mining-time-remaining">20</span>
                    <span id="mining-time-label">seconds</span>
                </div>
                <!-- Timing Bar -->
                <div id="mining-timing-container">
                    <div id="mining-timing-bar">
                        <div id="mining-sweet-spot"></div>
                        <div id="mining-indicator"></div>
                    </div>
                    <div id="mining-feedback"></div>
                </div>
                <!-- Score Area -->
                <div id="mining-score-area">
                    <div id="mining-ore-count">
                        <span id="mining-ore-icon">‚õè</span>
                        <span id="mining-ore-value">0</span>
                    </div>
                    <div id="mining-combo">
                        <span id="mining-combo-label">Combo</span>
                        <span id="mining-combo-value">0</span>
                    </div>
                    <div id="mining-score">
                        <span id="mining-score-label">Score</span>
                        <span id="mining-score-value">0</span>
                    </div>
                </div>
            </div>
            <div id="mining-popup-footer">
                <span id="mining-status-text">Swing your pickaxe!</span>
            </div>
        </div>
    </div>

    <!-- Mining Message -->
    <div id="mining-message"></div>

    <!-- Smelting Prompt -->
    <div id="smelting-prompt" class="interaction-prompt">
        <span class="prompt-key">F</span>
        <span class="prompt-text">Smelt</span>
    </div>

    <!-- Smelting Selection Popup -->
    <div id="smelting-selection">
        <div id="smelting-selection-content">
            <div id="smelting-selection-header">
                <span id="smelting-selection-title">Select Ore to Smelt</span>
                <button id="smelting-selection-close">X</button>
            </div>
            <div id="smelting-selection-grid"></div>
            <div id="smelting-selection-footer">
                <span>Click an ore to start smelting</span>
            </div>
        </div>
    </div>

    <!-- Smelting Popup -->
    <div id="smelting-popup">
        <div id="smelting-popup-content">
            <div id="smelting-popup-header">
                <span id="smelting-popup-title">Smelting!</span>
            </div>
            <div id="smelting-game-area">
                <div id="smelting-score-area">
                    <div id="smelting-bars">
                        <span id="smelting-bars-label">Smelted</span>
                        <span id="smelting-bars-value">0 / 0</span>
                    </div>
                    <div id="smelting-progress">
                        <span id="smelting-progress-label">Progress</span>
                        <div id="smelting-progress-bar">
                            <div id="smelting-progress-fill"></div>
                        </div>
                    </div>
                    <div id="smelting-rating">
                        <span id="smelting-rating-value">Smelting...</span>
                    </div>
                </div>
            </div>
            <div id="smelting-popup-footer">
                <span id="smelting-status-text">Smelting ore...</span>
            </div>
        </div>
    </div>

    <!-- Smelting Message -->
    <div id="smelting-message"></div>

    <!-- Chopping Prompt -->
    <div id="chopping-prompt" class="interaction-prompt">
        <span class="prompt-key">F</span>
        <span class="prompt-text">Chop</span>
    </div>

    <!-- Chopping Selection Popup -->
    <div id="chopping-selection">
        <div id="chopping-selection-content">
            <div id="chopping-selection-header">
                <span id="chopping-selection-title">Select Wood to Chop</span>
                <button id="chopping-selection-close">X</button>
            </div>
            <div id="chopping-selection-grid"></div>
            <div id="chopping-selection-footer">
                <span>Click a wood type to start chopping</span>
            </div>
        </div>
    </div>

    <!-- Chopping Popup -->
    <div id="chopping-popup">
        <div id="chopping-popup-content">
            <div id="chopping-popup-header">
                <span id="chopping-popup-title">Chopping!</span>
                <span id="chopping-popup-hint">Press SPACE to swing!</span>
            </div>
            <div id="chopping-game-area">
                <!-- Timer Display -->
                <div id="chopping-timer-display">
                    <span id="chopping-time-remaining">20</span>
                    <span id="chopping-time-label">seconds</span>
                </div>
                <!-- Timing Bar -->
                <div id="chopping-timing-container">
                    <div id="chopping-timing-bar">
                        <div id="chopping-sweet-spot"></div>
                        <div id="chopping-indicator"></div>
                    </div>
                    <div id="chopping-feedback"></div>
                </div>
                <!-- Score Area -->
                <div id="chopping-score-area">
                    <div id="chopping-wood-count">
                        <span id="chopping-wood-icon">ü™ì</span>
                        <span id="chopping-wood-value">0</span>
                    </div>
                    <div id="chopping-combo">
                        <span id="chopping-combo-label">Combo</span>
                        <span id="chopping-combo-value">0</span>
                    </div>
                    <div id="chopping-score">
                        <span id="chopping-score-label">Score</span>
                        <span id="chopping-score-value">0</span>
                    </div>
                </div>
            </div>
            <div id="chopping-popup-footer">
                <span id="chopping-status-text">Swing your axe!</span>
            </div>
        </div>
    </div>

    <!-- Chopping Message -->
    <div id="chopping-message"></div>

    <!-- Crafting Prompt -->
    <div id="crafting-prompt" class="interaction-prompt">
        <span class="prompt-key">F</span>
        <span class="prompt-text">Craft</span>
    </div>

    <!-- Crafting Selection Popup -->
    <div id="crafting-selection">
        <div id="crafting-selection-content">
            <div id="crafting-selection-header">
                <span id="crafting-selection-title">Crafting Bench</span>
                <button id="crafting-selection-close">X</button>
            </div>
            <div id="crafting-recipe-list"></div>
            <div id="crafting-selection-footer">
                <span>Click a recipe to craft</span>
            </div>
        </div>
    </div>

    <!-- Crafting Progress Popup -->
    <div id="crafting-popup">
        <div id="crafting-popup-content">
            <div id="crafting-popup-header">
                <span id="crafting-popup-title">Crafting...</span>
            </div>
            <div id="crafting-game-area">
                <div id="crafting-item-display">
                    <span id="crafting-item-icon"></span>
                    <span id="crafting-item-name"></span>
                </div>
                <div id="crafting-progress">
                    <div id="crafting-progress-bar">
                        <div id="crafting-progress-fill"></div>
                    </div>
                </div>
            </div>
            <div id="crafting-popup-footer">
                <span id="crafting-status-text">Creating item...</span>
            </div>
        </div>
    </div>

    <!-- Crafting Message -->
    <div id="crafting-message"></div>

    <!-- Anvil Prompt -->
    <div id="anvil-prompt" class="interaction-prompt">
        <span class="prompt-key">F</span>
        <span class="prompt-text">Forge</span>
    </div>

    <!-- Anvil Selection Popup -->
    <div id="anvil-selection">
        <div id="anvil-selection-content">
            <div id="anvil-selection-header">
                <span id="anvil-selection-title">Blacksmith Anvil</span>
                <button id="anvil-selection-close">X</button>
            </div>
            <div id="anvil-recipe-list"></div>
            <div id="anvil-selection-footer">
                <span>Click a recipe to forge</span>
            </div>
        </div>
    </div>

    <!-- Anvil Progress Popup -->
    <div id="anvil-popup">
        <div id="anvil-popup-content">
            <div id="anvil-popup-header">
                <span id="anvil-popup-title">Forging...</span>
            </div>
            <div id="anvil-game-area">
                <div id="anvil-item-display">
                    <span id="anvil-item-icon"></span>
                    <span id="anvil-item-name"></span>
                </div>
                <div id="anvil-progress">
                    <div id="anvil-progress-bar">
                        <div id="anvil-progress-fill"></div>
                    </div>
                </div>
            </div>
            <div id="anvil-popup-footer">
                <span id="anvil-status-text">Hammering metal...</span>
            </div>
        </div>
    </div>

    <!-- Anvil Message -->
    <div id="anvil-message"></div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>
    <script type="module" src="js/main.js?v=7"></script>
</body>
</html>
